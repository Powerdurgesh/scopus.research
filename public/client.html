<!DOCTYPE html>
<html>
<head><title>Client Camera Consent</title></head>
<body>
<h2>Click below to start your camera</h2>
<button onclick="startCamera('user')">Start Camera</button>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    let peer, stream;

    async function startCamera(facingMode = 'user') {
        try {
            stream = await navigator.mediaDevices.getUserMedia({
                video: { facingMode: { ideal: facingMode } },
                audio: true
            });

            peer = new RTCPeerConnection();
            stream.getTracks().forEach(track => peer.addTrack(track, stream));

            peer.onicecandidate = e => {
                if (e.candidate) socket.emit('candidate', e.candidate);
            };

            const offer = await peer.createOffer();
            await peer.setLocalDescription(offer);
            socket.emit('offer', offer);

            socket.on('answer', answer => peer.setRemoteDescription(answer));
            socket.on('candidate', candidate => peer.addIceCandidate(candidate));

            alert("Camera started and streaming to admin.");
        } catch (err) {
            console.error("Camera error:", err);
            alert("Error: " + err.message);
        }
    }
</script>
</body>
</html>
